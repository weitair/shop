(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/confirm/index"],{"0776":function(t,o,n){"use strict";(function(t){n("2490");i(n("66fd"));var o=i(n("1cd6"));function i(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,n("543d")["createPage"])},"1cd6":function(t,o,n){"use strict";n.r(o);var i=n("444a"),e=n("9b18");for(var u in e)"default"!==u&&function(t){n.d(o,t,(function(){return e[t]}))}(u);n("2d44");var s,r=n("f0c5"),c=Object(r["a"])(e["default"],i["b"],i["c"],!1,null,"6775e94a",null,!1,i["a"],s);o["default"]=c.exports},"1f9d":function(t,o,n){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i=s(n("f4df")),e=s(n("5231")),u=s(n("91e8"));s(n("dce3"));function s(t){return t&&t.__esModule?t:{default:t}}var r={data:function(){return{loading:!0,submitLoading:!1,coupon_show:!1,store_show:!1,time_show:!1,active:0,error:0,message:"",logistics:[],address:null,sku:[],coupon:[],coupon_current:{},goods_price:0,logistics_price:0,payment_price:0,invoice_status:0,store:[],time:[],active_day:0,active_time:0,subscribe:[],form:{sku:[],logistics:-1,address:0,invoice:0,coupon:0,contact:"",phone:"",store:0,day:"",time:"",message:"",lon:"",lat:"",channel:0,delivery_time:"",payment_channel:"wechat"}}},onLoad:function(o){var n=this;t.getLocation({type:"gcj02",success:function(t){n.form.lon=t.longitude+"",n.form.lat=t.latitude+""}}),n.form.channel=1,this.form.sku=i.default.get("sku"),i.default.remove("address"),i.default.remove("invoice"),this.getDetail()},onShow:function(){var t=i.default.get("address");t&&(this.form.address=t,this.getDetail());var o=i.default.get("invoice");this.form.invoice=o||0},computed:{couponComputed:function(){return this.form.coupon>0?this.coupon_current.coupon_type?this.coupon_current.discount+"折":"-￥"+this.coupon_current.amount:this.coupon.length>0?this.coupon.length+"张可用":"暂无可用"},storeShowComputed:function(){var t=this,o=null;return this.store.forEach((function(n){n.id==t.form.store&&(o=n)})),o},couponLinkComputed:function(){return this.coupon.length>0},timeShowComputed:function(){return""!==this.form.day&&""!==this.form.time?this.form.day+" "+this.form.time+"点":""}},methods:{getDetail:function(){var t=this;this.$post("/order/confirm",this.form,!0).then((function(o){var n=o.data;0==t.logistics.length&&n.methods.forEach((function(o){0==o&&t.logistics.push({title:"快递发货",value:0}),1==o&&t.logistics.push({title:"同城配送",value:1}),2==o&&t.logistics.push({title:"门店自提",value:2})})),t.error=n.error,t.message=n.message,t.sku=n.goods,t.address=n.logistics,t.coupon=n.coupon,t.goods_price=n.goods_price,t.logistics_price=n.logistics_price,t.store=n.store,t.time=n.time,t.payment_price=n.payment_price,t.invoice_status=n.setting.order.invoice,t.subscribe=n.subscribe,t.form.address=n.logistics?n.logistics.id:0,t.form.logistics=n.logistics_method})).catch((function(o){t.$util.toast(o.msg)})).finally((function(){t.loading=!1}))},logisticsChange:function(t,o){this.active=t,this.coupon_show=!1,this.store_show=!1,this.form.address=0,this.form.logistics=o,this.getDetail()},cuponShow:function(){this.coupon.length>0&&(this.coupon_show=!0)},selectCoupon:function(t){this.coupon_current=t,this.form.coupon=t.id,this.coupon_show=!1,this.getDetail()},clearCoupon:function(){this.coupon_current={},this.form.coupon=0,this.coupon_show=!1,this.getDetail()},submit:function(){var o=this,n=this;if(this.form.logistics<2&&!this.form.address)return this.$util.toast("请选择收货地址"),!1;if(2==this.form.logistics){if(!this.form.contact)return this.$util.toast("请输入提货人姓名"),!1;if(!e.default.phone(this.form.phone))return this.$util.toast("请输入正确的手机号码"),!1;if(!this.form.store)return this.$util.toast("请选择自提点"),!1}this.$util.submitPromise(this.subscribe).then((function(){o.submitLoading=!0,o.$post("/order/create",o.form,!0).then((function(o){var i=o.data;u.default.switch(i).then((function(o){n.$util.toast("支付成功",(function(){t.redirectTo({url:"/pages/order/detail/index?id="+i.id},"success")}))})).catch((function(o){n.$util.toast("您已取消本次支付",(function(){t.redirectTo({url:"/pages/order/detail/index?id="+i.id})}))}))})).catch((function(t){o.$util.toast(t.msg)})).finally((function(){o.submitLoading=!1}))}))},submitPromise:function(){var o=this;return new Promise((function(n,i){t.requestSubscribeMessage({tmplIds:o.subscribe,complete:function(t){n()}})}))},timeChange:function(t){this.form.day=t[0].value,this.form.time=t[1].value,this.time_show=!1},selectedStore:function(t){this.form.store!=t&&(this.form.store=t),this.store_show=!1},call:function(o){t.makePhoneCall({phoneNumber:o})},redirect:function(t){this.$util.redirect(t)}}};o.default=r}).call(this,n("543d")["default"])},"2d44":function(t,o,n){"use strict";var i=n("e6a0"),e=n.n(i);e.a},"444a":function(t,o,n){"use strict";n.d(o,"b",(function(){return e})),n.d(o,"c",(function(){return u})),n.d(o,"a",(function(){return i}));var i={wuiLoadLogin:function(){return Promise.all([n.e("common/vendor"),n.e("components/wui-load-login/wui-load-login")]).then(n.bind(null,"1989"))},wuiTabs:function(){return n.e("components/wui-tabs/wui-tabs").then(n.bind(null,"7b31"))},wuiCell:function(){return n.e("components/wui-cell/wui-cell").then(n.bind(null,"d5e2"))},wuiField:function(){return n.e("components/wui-field/wui-field").then(n.bind(null,"b0fe"))},wuiCard:function(){return n.e("components/wui-card/wui-card").then(n.bind(null,"8ac1"))},wuiGoodsCard:function(){return n.e("components/wui-goods-card/wui-goods-card").then(n.bind(null,"215a"))},wuiSubmitBar:function(){return n.e("components/wui-submit-bar/wui-submit-bar").then(n.bind(null,"8975"))},wuiButton:function(){return n.e("components/wui-button/wui-button").then(n.bind(null,"6821"))},wuiPopup:function(){return n.e("components/wui-popup/wui-popup").then(n.bind(null,"418e"))},wuiIcon:function(){return n.e("components/wui-icon/wui-icon").then(n.bind(null,"8901"))},wuiBottomAction:function(){return n.e("components/wui-bottom-action/wui-bottom-action").then(n.bind(null,"4892"))},wuiBottomActionButton:function(){return n.e("components/wui-bottom-action-button/wui-bottom-action-button").then(n.bind(null,"456c"))},wuiTreeSelect:function(){return n.e("components/wui-tree-select/wui-tree-select").then(n.bind(null,"d4e6"))},wuiCoupon:function(){return n.e("components/wui-coupon/wui-coupon").then(n.bind(null,"7771"))}},e=function(){var t=this,o=t.$createElement,n=(t._self._c,parseFloat(t.goods_price)),i=parseFloat(t.logistics_price),e=parseFloat(t.payment_price);t._isMounted||(t.e0=function(o){t.store_show=!0},t.e1=function(o){t.store_show=!0},t.e2=function(o){t.store_show=!1}),t.$mp.data=Object.assign({},{$root:{m0:n,m1:i,m2:e}})},u=[]},"9b18":function(t,o,n){"use strict";n.r(o);var i=n("1f9d"),e=n.n(i);for(var u in i)"default"!==u&&function(t){n.d(o,t,(function(){return i[t]}))}(u);o["default"]=e.a},e6a0:function(t,o,n){}},[["0776","common/runtime","common/vendor"]]]);